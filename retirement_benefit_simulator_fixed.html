<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>é€€è·çµ¦ä»˜é‡‘ï¼ˆå¤±æ¥­çµ¦ä»˜ï¼‰ã‹ã‚“ãŸã‚“è¨ºæ–­</title>
  <style>
:root{
  --bg:#0b1020;
  --card: rgba(255,255,255,.06);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.65);
  --line: rgba(255,255,255,.12);
  --accent:#7dd3fc;
  --accent2:#a78bfa;
  --shadow: 0 18px 50px rgba(0,0,0,.45);
  --radius: 18px;
}
*{ box-sizing: border-box; }
html,body{ height: 100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
  color: var(--text);
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(125,211,252,.25), transparent 55%),
    radial-gradient(900px 600px at 90% 0%, rgba(167,139,250,.22), transparent 60%),
    radial-gradient(900px 700px at 50% 110%, rgba(52,211,153,.14), transparent 60%),
    var(--bg);
}
.wrap{ width:min(1100px, calc(100% - 32px)); margin: 0 auto; }
.hero{
  padding: 34px 0 18px;
  border-bottom: 1px solid var(--line);
  background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
}
.badge{
  display:inline-flex;
  align-items:center;
  padding: 8px 12px;
  border: 1px solid var(--line);
  border-radius: 999px;
  background: rgba(255,255,255,.06);
  color: var(--muted);
  font-size: 12px;
}
h1{ margin: 14px 0 10px; font-size: clamp(22px, 3vw, 34px); letter-spacing: .02em; }
.accent{
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  -webkit-background-clip: text; background-clip: text;
  color: transparent;
}
.sub{ margin:0; color: var(--muted); line-height: 1.7; }
.grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  padding: 18px 0 22px;
}
@media (max-width: 960px){ .grid{ grid-template-columns: 1fr; } }
.card{
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 18px;
}
h2{ margin: 0 0 14px; font-size: 18px; }
.row{ margin: 12px 0; }
label{ display:block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
input, select{
  width:100%;
  color: var(--text);
  background: rgba(0,0,0,.22);
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 12px 12px;
  outline: none;
}
input:focus, select:focus{
  border-color: rgba(125,211,252,.6);
  box-shadow: 0 0 0 4px rgba(125,211,252,.12);
}
.ctrl{ position: relative; display:flex; align-items:center; }
.ctrl input{ padding-right: 44px; }
.unit{
  position:absolute; right: 12px;
  color: var(--muted); font-size: 12px; pointer-events:none;
}
.hint{ margin: 8px 0 0; font-size: 12px; color: var(--muted); line-height: 1.6; }
.box{
  margin: 10px 0 0;
  padding: 12px;
  border: 1px solid var(--line);
  border-radius: 14px;
  background: rgba(0,0,0,.18);
}
.check{ display:flex; gap: 10px; align-items:flex-start; margin: 8px 0; }
.check input{ width: 18px; height: 18px; margin-top: 2px; }
.check label{ margin:0; font-size: 13px; color: var(--text); }

.actions{ display:flex; gap: 10px; margin-top: 14px; }
.btn{
  border-radius: 14px;
  border: 1px solid var(--line);
  padding: 12px 14px;
  background: rgba(255,255,255,.06);
  color: var(--text);
  cursor:pointer;
  font-weight: 800;
  letter-spacing: .02em;
}
.btn:hover{ background: rgba(255,255,255,.09); }
.btn.primary{
  border-color: rgba(125,211,252,.45);
  background: linear-gradient(90deg, rgba(125,211,252,.22), rgba(167,139,250,.20));
}
.btn.ghost{ background: rgba(0,0,0,.14); }
.btn.small{ padding: 8px 12px; border-radius: 12px; font-size: 12px; }
.btn:disabled{ opacity: .55; cursor: not-allowed; }

.msg{
  margin-top: 12px;
  min-height: 20px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.6;
}
.msg.ok{ color: rgba(52,211,153,.95); }
.msg.warn{ color: rgba(251,191,36,.95); }
.msg.bad{ color: rgba(251,113,133,.95); }

.resultHead{
  display:flex;
  justify-content: space-between;
  align-items:center;
  gap: 10px;
  margin-bottom: 10px;
}
.result{
  border: 1px solid var(--line);
  border-radius: 16px;
  padding: 14px;
  background: rgba(0,0,0,.18);
}
.empty{ text-align:center; padding: 18px 10px; color: var(--muted); }
.spark{ font-size: 28px; margin-bottom: 8px; }

.kpis{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
@media (max-width: 520px){ .kpis{ grid-template-columns: 1fr; } }
.kpi{
  padding: 12px;
  border: 1px solid var(--line);
  border-radius: 14px;
  background: rgba(255,255,255,.06);
}
.kpi .t{ color: var(--muted); font-size: 12px; }
.kpi .v{ margin-top: 6px; font-size: 18px; font-weight: 900; letter-spacing: .02em; }
.kpi .s{ margin-top: 4px; color: var(--muted); font-size: 12px; line-height: 1.6; }

.block{
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px dashed var(--line);
  color: var(--muted);
  line-height: 1.7;
  font-size: 13px;
}
.detail{
  margin-top: 12px;
  border: 1px solid var(--line);
  border-radius: 16px;
  padding: 12px 14px;
  background: rgba(255,255,255,.05);
}
.detail summary{ cursor:pointer; font-weight: 900; color: var(--text); }
.footer{ padding: 10px 0 22px; }
  </style>
</head>
<body>
  <header class="hero">
    <div class="wrap">
      <div class="badge">æ¦‚ç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
      <h1>é€€è·çµ¦ä»˜é‡‘ï¼ˆå¤±æ¥­çµ¦ä»˜ï¼‰<span class="accent">ã‹ã‚“ãŸã‚“è¨ºæ–­</span></h1>
      <p class="sub">
        ç›´è¿‘6ã‹æœˆã®è³ƒé‡‘ãƒ»å¹´é½¢ãƒ»é›‡ç”¨ä¿é™ºã®åŠ å…¥æœŸé–“ãƒ»é›¢è·ç†ç”±ã‹ã‚‰ã€<b>1æ—¥ã‚ãŸã‚Š</b>ã¨<b>ç·é¡</b>ã®ç›®å®‰ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
        <span style="opacity:.75">ï¼ˆæœ€çµ‚çš„ãªé‡‘é¡ã¯ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚¯ã®æ±ºå®šãŒå„ªå…ˆï¼‰</span>
      </p>
    </div>
  </header>

  <main class="wrap grid">
    <section class="card">
      <h2>å…¥åŠ›</h2>

      <div class="row">
        <label for="age">é›¢è·æ™‚ã®å¹´é½¢ï¼ˆå¿…é ˆï¼‰</label>
        <div class="ctrl">
          <input id="age" type="number" inputmode="numeric" min="15" max="100" placeholder="ä¾‹ï¼š35" />
          <span class="unit">æ­³</span>
        </div>
      </div>

      <div class="row">
        <label for="insuredMonths">é›‡ç”¨ä¿é™ºã®åŠ å…¥æœŸé–“ï¼ˆé€šç®—ï¼‰</label>
        <div class="ctrl">
          <input id="insuredMonths" type="number" inputmode="numeric" min="0" max="600" placeholder="ä¾‹ï¼š84ï¼ˆ=7å¹´ï¼‰" />
          <span class="unit">ã‹æœˆ</span>
        </div>
        <p class="hint">æœªå…¥åŠ›ã§ã‚‚è¨ˆç®—ã¯ã§ãã¾ã™ï¼ˆæ‰€å®šçµ¦ä»˜æ—¥æ•°ã¯â€œæœ€çŸ­å¯„ã‚Šâ€ã§æ¦‚ç®—ï¼‰ã€‚</p>
      </div>

      <div class="row">
        <label for="wage6m">é›¢è·ç›´å‰6ã‹æœˆã®è³ƒé‡‘åˆè¨ˆï¼ˆå¿…é ˆãƒ»ç¨å¼•å‰ï¼‰</label>
        <div class="ctrl">
          <input id="wage6m" type="number" inputmode="numeric" min="0" step="1000" placeholder="ä¾‹ï¼š1800000" />
          <span class="unit">å††</span>
        </div>
        <p class="hint">åŸå‰‡ã€Œæ¯æœˆæ±ºã¾ã£ã¦æ”¯æ‰•ã‚ã‚ŒãŸè³ƒé‡‘ã€ã®åˆè¨ˆã‚’æƒ³å®šï¼ˆè³ä¸ã¯é™¤å¤–ï¼‰ã€‚</p>
      </div>

      <div class="row">
        <label for="reason">é›¢è·ç†ç”±ï¼ˆã–ã£ãã‚Šï¼‰</label>
        <select id="reason">
          <option value="self" selected>è‡ªå·±éƒ½åˆï¼ˆçµ¦ä»˜åˆ¶é™ã‚ã‚Šï¼‰</option>
          <option value="retire">å®šå¹´ãƒ»å¥‘ç´„æº€äº†ãªã©ï¼ˆçµ¦ä»˜åˆ¶é™ãªã—æ‰±ã„ï¼‰</option>
          <option value="special">ä¼šç¤¾éƒ½åˆï¼ˆå€’ç”£ãƒ»è§£é›‡ãªã©ï¼‰/ ç‰¹å®šç†ç”±ï¼ˆçµ¦ä»˜åˆ¶é™ãªã—ï¼‰</option>
          <option value="difficult">å°±è·å›°é›£è€…ï¼ˆéšœå®³ç­‰ï¼‰</option>
        </select>
      </div>

      <div id="selfBox" class="box">
        <div class="check">
          <input id="repeatSelf" type="checkbox" />
          <label for="repeatSelf">éå»5å¹´ã§ã€Œè‡ªå·±éƒ½åˆã«ã‚ˆã‚‹å—çµ¦ã€ãŒ2å›ä»¥ä¸Šï¼ˆçµ¦ä»˜åˆ¶é™ãŒ3ã‹æœˆã«ãªã‚‹å¯èƒ½æ€§ï¼‰</label>
        </div>
        <div class="check">
          <input id="trainingRelease" type="checkbox" />
          <label for="trainingRelease">æ•™è‚²è¨“ç·´ç­‰ã«ã‚ˆã‚Šçµ¦ä»˜åˆ¶é™ãŒè§£é™¤ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã«è©²å½“ï¼ˆåˆ†ã‹ã‚‹å ´åˆã®ã¿ï¼‰</label>
        </div>
      </div>

      <div class="row">
        <label for="applyDate">ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚¯ã§æ±‚è·ç”³è¾¼ã—ãŸæ—¥ï¼ˆç›®å®‰ï¼‰</label>
        <input id="applyDate" type="date" />
        <p class="hint">ã“ã“ã¯æœªå…¥åŠ›ã§ã‚‚OKï¼ˆä»Šæ—¥ã§è¨ˆç®—ï¼‰ã€‚</p>
      </div>

      <div class="actions">
        <button id="calcBtn" class="btn primary" type="button">è¨ºæ–­ã™ã‚‹</button>
        <button id="resetBtn" class="btn ghost" type="button">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <div id="msg" class="msg" aria-live="polite"></div>
    </section>

    <section class="card">
      <div class="resultHead">
        <h2>çµæœ</h2>
        <button id="copyBtn" class="btn small" type="button" disabled>çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>

      <div id="result" class="result">
        <div class="empty">
          <div class="spark">ğŸ§¾</div>
          <p>å·¦ã®å…¥åŠ›ã‚’åŸ‹ã‚ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
      </div>

      <details class="detail">
        <summary>è¨ˆç®—ã®å‰æï¼ˆã‚¯ãƒªãƒƒã‚¯ã§è¡¨ç¤ºï¼‰</summary>
        <ul>
          <li>è³ƒé‡‘æ—¥é¡ ï¼ ç›´è¿‘6ã‹æœˆè³ƒé‡‘åˆè¨ˆ Ã· 180ï¼ˆæ¦‚ç®—ï¼‰</li>
          <li>åŸºæœ¬æ‰‹å½“æ—¥é¡ ï¼ è³ƒé‡‘æ—¥é¡ Ã—ï¼ˆç´„45%ã€œ80%ï¼‰ï¼‹ä¸Šé™/ä¸‹é™ã®é©ç”¨</li>
          <li>æ‰€å®šçµ¦ä»˜æ—¥æ•°ã¯ã€é›¢è·ç†ç”±ãƒ»å¹´é½¢ãƒ»åŠ å…¥æœŸé–“ã§æ¦‚ç®—</li>
          <li>æ”¯çµ¦é–‹å§‹ç›®å®‰ï¼šæ±‚è·ç”³è¾¼æ—¥ã‹ã‚‰ã€Œå¾…æœŸ7æ—¥ã€ï¼‹ï¼ˆè‡ªå·±éƒ½åˆãªã‚‰çµ¦ä»˜åˆ¶é™ï¼‰</li>
        </ul>
      </details>
    </section>
  </main>

  <footer class="footer wrap">
    <p style="opacity:.7; font-size:12px; line-height:1.6;">
      â€»ã“ã®ãƒ„ãƒ¼ãƒ«ã¯æ¦‚ç®—ã§ã™ã€‚å®Ÿéš›ã®å—çµ¦å¯å¦ãƒ»é‡‘é¡ãƒ»çµ¦ä»˜åˆ¶é™ã¯ã€é›¢è·ç¥¨ã®å†…å®¹ã‚„å€‹åˆ¥äº‹æƒ…ã«ã‚ˆã‚Šå¤‰ã‚ã‚Šã¾ã™ã€‚
    </p>
  </footer>

  <script>
(() => {
  "use strict";

  // ã‚‚ã—åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¦ã‚‚ã€ç”»é¢ã«å‡ºã™ï¼ˆãƒœã‚¿ãƒ³ç„¡åå¿œå¯¾ç­–ï¼‰
  window.addEventListener("error", (e) => {
    const msg = document.getElementById("msg");
    if (msg) {
      msg.className = "msg bad";
      msg.textContent = "ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒ©ãƒ¼: " + (e?.message || "unknown");
    }
  });

  const CONFIG = {
    ruleName: "ä»¤å’Œ7å¹´8æœˆ1æ—¥åŸºæº–ï¼ˆç›®å®‰ï¼‰",
    minWageDaily: 3014,
    maxWageDailyByAge: { u29:14510, a30_44:16110, a45_59:17740, a60_64:16940, a65plus:16940 },
    minBenefitDaily: 2411,
    maxBenefitDailyByAge:{ u29:7255, a30_44:8055, a45_59:8870, a60_64:7623, a65plus:7623 },
    borderLow: 5340,
    borderHigh_59: 13140,
    borderHigh_60_64: 11800,
    selfRestrictionMonthsAfter2025_04_01: 1,
    selfRestrictionMonthsBefore2025_04_01: 2,
    selfRestrictionPenaltyMonths: 3,
    lawChangeDate: "2025-04-01",
  };

  const yen = new Intl.NumberFormat("ja-JP");
  const $ = (id) => document.getElementById(id);

  const els = {
    age: $("age"),
    insuredMonths: $("insuredMonths"),
    wage6m: $("wage6m"),
    reason: $("reason"),
    selfBox: $("selfBox"),
    repeatSelf: $("repeatSelf"),
    trainingRelease: $("trainingRelease"),
    applyDate: $("applyDate"),
    calcBtn: $("calcBtn"),
    resetBtn: $("resetBtn"),
    copyBtn: $("copyBtn"),
    msg: $("msg"),
    result: $("result"),
  };

  document.addEventListener("DOMContentLoaded", init);

  function init(){
    // dateåˆæœŸå€¤ï¼ˆvalueAsDate ã‚’ä½¿ã‚ãªã„ï¼ç’°å¢ƒå·®ã§å£Šã‚Œã«ãã„ï¼‰
    setTodayIfEmpty(els.applyDate);

    els.reason.addEventListener("change", syncSelfOptions);
    els.calcBtn.addEventListener("click", onCalc);
    els.resetBtn.addEventListener("click", onReset);
    els.copyBtn.addEventListener("click", onCopy);

    syncSelfOptions();
    renderEmpty();
  }

  function setTodayIfEmpty(input){
    if (!input) return;
    if (input.value) return;
    const d = new Date();
    input.value = formatDate(d);
  }

  function syncSelfOptions(){
    const isSelf = els.reason.value === "self";
    els.selfBox.style.display = isSelf ? "block" : "none";
  }

  function onReset(){
    els.age.value = "";
    els.insuredMonths.value = "";
    els.wage6m.value = "";
    els.reason.value = "self";
    els.repeatSelf.checked = false;
    els.trainingRelease.checked = false;
    els.applyDate.value = formatDate(new Date());
    syncSelfOptions();
    clearMsg();
    renderEmpty();
    els.copyBtn.disabled = true;
  }

  function onCalc(){
    clearMsg();

    const age = toInt(els.age.value);
    const wage6m = toInt(els.wage6m.value);
    const insuredMonths = toIntOrZero(els.insuredMonths.value);
    const reason = els.reason.value;

    const applyDate = parseDateOrToday(els.applyDate.value);

    const errors = [];
    if (!isFinite(age) || age < 15 || age > 100) errors.push("å¹´é½¢ï¼ˆå¿…é ˆï¼‰ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ15ã€œ100ï¼‰ã€‚");
    if (!isFinite(wage6m) || wage6m <= 0) errors.push("6ã‹æœˆè³ƒé‡‘åˆè¨ˆï¼ˆå¿…é ˆï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

    if (errors.length){
      setMsg(errors.join(" "), "bad");
      renderEmpty();
      els.copyBtn.disabled = true;
      return;
    }

    const ageBand = getAgeBand(age);

    const wageDailyRaw = wage6m / 180;
    const wageDaily = clamp(wageDailyRaw, CONFIG.minWageDaily, CONFIG.maxWageDailyByAge[ageBand]);

    const benefitDailyRaw = computeBenefitDaily(wageDaily, age);
    const benefitDaily = clamp(benefitDailyRaw, CONFIG.minBenefitDaily, CONFIG.maxBenefitDailyByAge[ageBand]);

    const days = computeBenefitDays(reason, age, insuredMonths);

    const restrictionMonths = computeRestrictionMonths(reason, age, applyDate);
    const startDate = estimateStartDate(applyDate, restrictionMonths);
    const endDate = estimateEndDate(startDate, days);

    const total = Math.floor(benefitDaily) * days;
    const monthly28 = Math.floor(benefitDaily) * 28;

    const isHighAge = age >= 65;

    renderResult({
      age, insuredMonths, wage6m, reason,
      wageDaily, wageDailyRaw,
      benefitDaily, benefitDailyRaw,
      days, total, monthly28,
      restrictionMonths, startDate, endDate,
      isHighAge
    });

    els.copyBtn.disabled = false;

    const warns = [];
    if (!els.insuredMonths.value) warns.push("åŠ å…¥æœŸé–“ãŒæœªå…¥åŠ›ãªã®ã§ã€æ‰€å®šçµ¦ä»˜æ—¥æ•°ã¯â€œæœ€çŸ­å¯„ã‚Šâ€ã§æ¦‚ç®—ã€‚");
    setMsg([`è¨ˆç®—ãƒ«ãƒ¼ãƒ«ï¼š${CONFIG.ruleName}`, ...warns].join(" / "), warns.length ? "warn" : "ok");
  }

  function onCopy(){
    const text = buildCopyTextFromResult();
    if (!text){
      setMsg("ã‚³ãƒ”ãƒ¼ã™ã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚", "warn");
      return;
    }
    copyToClipboard(text)
      .then(() => setMsg("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚", "ok"))
      .catch(() => setMsg("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®æ¨©é™è¨­å®šã‚’ã”ç¢ºèªãã ã•ã„ï¼‰ã€‚", "bad"));
  }

  function renderEmpty(){
    els.result.innerHTML = `
      <div class="empty">
        <div class="spark">ğŸ§¾</div>
        <p>å·¦ã®å…¥åŠ›ã‚’åŸ‹ã‚ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
      </div>
    `;
    delete els.result.dataset.copy;
  }

  function renderResult(r){
    const reasonLabel = reasonToLabel(r.reason);
    const ageBandLabel = ageBandToLabel(getAgeBand(r.age));
    const startStr = formatDate(r.startDate);
    const endStr = formatDate(r.endDate);

    const restrictionStr =
      r.reason === "self"
        ? (r.restrictionMonths === 0 ? "ãªã—ï¼ˆè§£é™¤ï¼‰" : `${r.restrictionMonths}ã‹æœˆ`)
        : "ãªã—";

    const title = r.isHighAge ? "é«˜å¹´é½¢æ±‚è·è€…çµ¦ä»˜é‡‘ï¼ˆ65æ­³ä»¥ä¸Šï¼‰" : "åŸºæœ¬æ‰‹å½“ï¼ˆå¤±æ¥­æ‰‹å½“ï¼‰";
    const payoutNote = r.isHighAge
      ? "â€»65æ­³ä»¥ä¸Šã¯ä¸€æ‹¬çµ¦ä»˜æ‰±ã„ã®ãŸã‚ã€è¡¨ç¤ºã¯æ¦‚ç®—ã§ã™ã€‚"
      : "â€»é€šå¸¸ã¯4é€±é–“ã”ã¨ã®èªå®šã§æ”¯çµ¦ï¼ˆã“ã“ã§ã¯ç·é¡ã¨28æ—¥æ›ç®—ã‚’è¡¨ç¤ºï¼‰ã€‚";

    els.result.innerHTML = `
      <div class="kpis">
        <div class="kpi">
          <div class="t">è³ƒé‡‘æ—¥é¡ï¼ˆæ¦‚ç®—ï¼‰</div>
          <div class="v">${yen.format(Math.floor(r.wageDaily))}å††</div>
          <div class="s">6ã‹æœˆè³ƒé‡‘åˆè¨ˆ Ã· 180ï¼ˆä¸Šé™/ä¸‹é™åæ˜ ï¼‰</div>
        </div>
        <div class="kpi">
          <div class="t">åŸºæœ¬æ‰‹å½“æ—¥é¡ï¼ˆæ¦‚ç®—ï¼‰</div>
          <div class="v">${yen.format(Math.floor(r.benefitDaily))}å††</div>
          <div class="s">çµ¦ä»˜ç‡ï¼ˆç´„45ã€œ80%ï¼‰ï¼‹ä¸Šé™/ä¸‹é™åæ˜ </div>
        </div>
        <div class="kpi">
          <div class="t">ç·é¡ï¼ˆæ¦‚ç®—ï¼‰</div>
          <div class="v">${yen.format(r.total)}å††</div>
          <div class="s">åŸºæœ¬æ‰‹å½“æ—¥é¡ Ã— æ‰€å®šçµ¦ä»˜æ—¥æ•°ï¼ˆ${r.days}æ—¥ï¼‰</div>
        </div>
        <div class="kpi">
          <div class="t">æœˆã‚ãŸã‚Šç›®å®‰ï¼ˆ28æ—¥æ›ç®—ï¼‰</div>
          <div class="v">${yen.format(r.monthly28)}å††</div>
          <div class="s">ã‚ãã¾ã§ç›®å®‰</div>
        </div>
      </div>

      <div class="block">
        <div><b>åŒºåˆ†ï¼š</b>${escapeHtml(title)}</div>
        <div><b>é›¢è·ç†ç”±ï¼š</b>${escapeHtml(reasonLabel)}</div>
        <div><b>å¹´é½¢åŒºåˆ†ï¼š</b>${escapeHtml(ageBandLabel)}</div>
        <div><b>æ‰€å®šçµ¦ä»˜æ—¥æ•°ï¼š</b>${r.days}æ—¥</div>
        <div><b>çµ¦ä»˜åˆ¶é™ï¼ˆè‡ªå·±éƒ½åˆã®ã¿ï¼‰ï¼š</b>${restrictionStr}</div>
        <div><b>æ”¯çµ¦é–‹å§‹ã®ç›®å®‰ï¼š</b>${startStr}ã”ã‚ï¼ˆå¾…æœŸ7æ—¥ï¼‹çµ¦ä»˜åˆ¶é™åæ˜ ï¼‰</div>
        <div><b>å—çµ¦çµ‚äº†ã®ç›®å®‰ï¼š</b>${endStr}ã”ã‚</div>
        <div style="margin-top:6px; opacity:.8;">${escapeHtml(payoutNote)}</div>
      </div>
    `;

    els.result.dataset.copy = JSON.stringify({
      title,
      reason: reasonLabel,
      age: r.age,
      insuredMonths: r.insuredMonths,
      wage6m: r.wage6m,
      wageDaily: Math.floor(r.wageDaily),
      benefitDaily: Math.floor(r.benefitDaily),
      days: r.days,
      total: r.total,
      monthly28: r.monthly28,
      restrictionMonths: r.restrictionMonths,
      start: startStr,
      end: endStr,
      ruleName: CONFIG.ruleName
    });
  }

  function buildCopyTextFromResult(){
    const raw = els.result.dataset.copy;
    if (!raw) return "";
    let d;
    try{ d = JSON.parse(raw); } catch { return ""; }

    const restriction = (d.restrictionMonths === 0 ? "ãªã—/è§£é™¤" : `${d.restrictionMonths}ã‹æœˆ`);

    return [
      `ã€${d.title} æ¦‚ç®—çµæœã€‘`,
      `é›¢è·ç†ç”±ï¼š${d.reason}`,
      `å¹´é½¢ï¼š${d.age}æ­³ / åŠ å…¥æœŸé–“ï¼š${d.insuredMonths}ã‹æœˆ`,
      `ç›´è¿‘6ã‹æœˆè³ƒé‡‘åˆè¨ˆï¼š${yen.format(d.wage6m)}å††`,
      `è³ƒé‡‘æ—¥é¡ï¼š${yen.format(d.wageDaily)}å††`,
      `åŸºæœ¬æ‰‹å½“æ—¥é¡ï¼š${yen.format(d.benefitDaily)}å††`,
      `æ‰€å®šçµ¦ä»˜æ—¥æ•°ï¼š${d.days}æ—¥`,
      `ç·é¡ï¼š${yen.format(d.total)}å††`,
      `æœˆç›®å®‰ï¼ˆ28æ—¥æ›ç®—ï¼‰ï¼š${yen.format(d.monthly28)}å††`,
      `çµ¦ä»˜åˆ¶é™ï¼ˆè‡ªå·±éƒ½åˆã®ã¿ï¼‰ï¼š${restriction}`,
      `æ”¯çµ¦é–‹å§‹ç›®å®‰ï¼š${d.start} / çµ‚äº†ç›®å®‰ï¼š${d.end}`,
      `ï¼ˆè¨ˆç®—ãƒ«ãƒ¼ãƒ«ï¼š${d.ruleName}ï¼‰`,
      `â€»æœ€çµ‚é‡‘é¡ã¯ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚¯ã®æ±ºå®šãŒå„ªå…ˆã§ã™ã€‚`
    ].join("\n");
  }

  // ===== è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ =====

  function getAgeBand(age){
    if (age <= 29) return "u29";
    if (age <= 44) return "a30_44";
    if (age <= 59) return "a45_59";
    if (age <= 64) return "a60_64";
    return "a65plus";
  }

  function computeBenefitDaily(w, age){
    let y;
    if (age <= 59){
      if (w < CONFIG.borderLow){
        y = 0.8 * w;
      } else if (w <= CONFIG.borderHigh_59){
        y = 0.8 * w - 0.3 * ((w - CONFIG.borderLow) / 7800) * w;
      } else {
        y = 0.5 * w;
      }
    } else {
      if (w < CONFIG.borderLow){
        y = 0.8 * w;
      } else if (w <= CONFIG.borderHigh_60_64){
        const y1 = 0.8 * w - 0.35 * ((w - CONFIG.borderLow) / 6460) * w;
        const y2 = 0.05 * w + 4720;
        y = Math.min(y1, y2);
      } else {
        y = 0.45 * w;
      }
    }
    return Math.floor(y);
  }

  function computeBenefitDays(reason, age, insuredMonths){
    const years = insuredMonths / 12;

    if (age >= 65){
      return years >= 1 ? 50 : 30;
    }
    if (reason === "difficult"){
      if (age < 45) return years >= 1 ? 300 : 150;
      return 360;
    }
    if (reason === "special"){
      const col = pickColumnForSpecial(years);
      const row = pickRowForSpecial(age);
      return specialDaysTable(row, col);
    }
    // retire / self ã¯ä¸€èˆ¬æ‰±ã„
    return generalDays(years);
  }

  function generalDays(years){
    if (years < 10) return 90;
    if (years < 20) return 120;
    return 150;
  }

  function pickColumnForSpecial(years){
    if (years < 1) return 0;
    if (years < 5) return 1;
    if (years < 10) return 2;
    if (years < 20) return 3;
    return 4;
  }

  function pickRowForSpecial(age){
    if (age < 30) return "u30";
    if (age < 35) return "a30_34";
    if (age < 45) return "a35_44";
    if (age < 60) return "a45_59";
    return "a60_64";
  }

  function specialDaysTable(row, col){
    const table = {
      u30:     [  90,   90,   120,   180,  180 ],
      a30_34:  [  90,  120,   180,   210,  240 ],
      a35_44:  [  90,  150,   180,   240,  270 ],
      a45_59:  [  90,  180,   240,   270,  330 ],
      a60_64:  [  90,  150,   180,   210,  240 ],
    };
    return table[row][col];
  }

  function computeRestrictionMonths(reason, age, applyDate){
    if (age >= 65) return 0;
    if (reason !== "self") return 0;
    if (els.trainingRelease.checked) return 0;

    const change = new Date(CONFIG.lawChangeDate + "T00:00:00");
    const base = (applyDate >= change)
      ? CONFIG.selfRestrictionMonthsAfter2025_04_01
      : CONFIG.selfRestrictionMonthsBefore2025_04_01;

    if (els.repeatSelf.checked) return CONFIG.selfRestrictionPenaltyMonths;
    return base;
  }

  function estimateStartDate(applyDate, restrictionMonths){
    const d = new Date(applyDate);
    d.setDate(d.getDate() + 7);
    return addMonths(d, restrictionMonths);
  }

  function estimateEndDate(startDate, days){
    const d = new Date(startDate);
    d.setDate(d.getDate() + Math.max(0, days - 1));
    return d;
  }

  // ===== UIè£œåŠ© =====
  function reasonToLabel(v){
    switch(v){
      case "self": return "è‡ªå·±éƒ½åˆï¼ˆçµ¦ä»˜åˆ¶é™ã‚ã‚Šï¼‰";
      case "retire": return "å®šå¹´ãƒ»å¥‘ç´„æº€äº†ãªã©ï¼ˆçµ¦ä»˜åˆ¶é™ãªã—æ‰±ã„ï¼‰";
      case "special": return "ä¼šç¤¾éƒ½åˆï¼ˆå€’ç”£ãƒ»è§£é›‡ç­‰ï¼‰/ ç‰¹å®šç†ç”±ï¼ˆçµ¦ä»˜åˆ¶é™ãªã—ï¼‰";
      case "difficult": return "å°±è·å›°é›£è€…ï¼ˆéšœå®³ç­‰ï¼‰";
      default: return v;
    }
  }
  function ageBandToLabel(b){
    switch(b){
      case "u29": return "29æ­³ä»¥ä¸‹";
      case "a30_44": return "30ã€œ44æ­³";
      case "a45_59": return "45ã€œ59æ­³";
      case "a60_64": return "60ã€œ64æ­³";
      case "a65plus": return "65æ­³ä»¥ä¸Š";
      default: return b;
    }
  }

  function setMsg(text, level){
    els.msg.textContent = text || "";
    els.msg.className = "msg" + (level ? ` ${level}` : "");
  }
  function clearMsg(){ setMsg("", ""); }

  function toInt(v){
    const n = Number(String(v).replace(/,/g,""));
    return Number.isFinite(n) ? Math.floor(n) : NaN;
  }
  function toIntOrZero(v){
    const n = Number(String(v).replace(/,/g,""));
    return Number.isFinite(n) ? Math.floor(n) : 0;
  }
  function clamp(x, min, max){ return Math.max(min, Math.min(max, x)); }

  function addMonths(date, months){
    const d = new Date(date);
    const day = d.getDate();
    d.setMonth(d.getMonth() + months);
    if (d.getDate() !== day) d.setDate(0);
    return d;
  }

  function formatDate(d){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${dd}`;
  }

  function parseDateOrToday(str){
    if (!str) return new Date();
    const d = new Date(str + "T00:00:00");
    return isNaN(d.getTime()) ? new Date() : d;
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }

  function copyToClipboard(text){
    if (navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(text);
    }
    return new Promise((resolve, reject) => {
      try{
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        ta.style.top = "0";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        const ok = document.execCommand("copy");
        document.body.removeChild(ta);
        ok ? resolve() : reject();
      }catch{
        reject();
      }
    });
  }
})();
  </script>
</body>
</html>
